<!DOCTYPE html><!--iMnIBittzbL6au_Q1HsmL--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/cbe20c40552e0328.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/340e600f8638470f.js"/><script src="/_next/static/chunks/248cba0fcb3874ed.js" async=""></script><script src="/_next/static/chunks/8296bf97416a5ebf.js" async=""></script><script src="/_next/static/chunks/834800a6b130715c.js" async=""></script><script src="/_next/static/chunks/5997132b61dec430.js" async=""></script><script src="/_next/static/chunks/turbopack-04e8e4c77cb266fa.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/247eb132b7f7b574.js" async=""></script><script src="/_next/static/chunks/830a5e4b540dd4df.js" async=""></script><script src="/_next/static/chunks/3ed9d616c74adb07.js" async=""></script><script src="/_next/static/chunks/ad0a5a8fb2ac436e.js" async=""></script><script src="/_next/static/chunks/0434e8cb22e550ab.js" async=""></script><meta name="next-size-adjust" content=""/><link rel="icon" href="/favicon.ico?favicon.0b3bf435.ico" sizes="256x256" type="image/x-icon"/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="geist_a71539c9-module__T19VSG__variable geist_mono_8d43a2aa-module__8Li5zG__variable overflow-x-hidden"><div hidden=""><!--$--><!--/$--></div><header class="absolute lg:place-self-center top-0 w-full z-20"><div class="bg-indigo-400 backdrop-blur-2xl p-5 text-2xl rounded-b-xl flex justify-between items-center max-w-[1480px] mx-auto"><a href="/"><img alt="" loading="lazy" width="170" height="40" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/Logo.e96ee33b.svg"/></a><div class="hidden md:block"><nav class="w-full"><menu class=" flex items-center gap-x-6 w-full text-black text-2xl"><li><a class=" " href="/#About">О компании</a></li><li><a class=" " href="/Jobs">Вакансии</a></li><li><a class=" " href="/Articles">Блог</a></li><li><a class=" " href="/Projects">Проекты</a></li></menu></nav></div><div class="ml-auto md:ml-[unset] block lg:hidden"><ul class="flex items-center gap-x-2"><li class="block md:hidden"><button data-slot="button" class="inline-flex cursor items-center justify-center gap-2 cursor-pointer whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-12 border-none text-white bg-indigo-950"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 12h18"></path><path d="M3 18h18"></path><path d="M3 6h18"></path></svg></button></li></ul></div></div><div class="fixed inset-0 z-40 bg-black/30 backdrop-blur-md transition-opacity duration-200 opacity-0 invisible"></div><aside class="fixed top-0 right-0 bottom-0 p-5 max-w-xs w-full h-screen bg-zinc-900 border-l border-zinc-700 z-50 transform transition-transform translate-x-full"><div class="w-full space-y-4"><menu class="w-full text-white"><div class="flex items-center "><a href="/"><img alt="Логотип сайта" loading="lazy" width="170" height="40" decoding="async" data-nimg="1" class="" style="color:transparent" src="/_next/static/media/Logo_footer.05098c44.svg"/></a></div><li class="w-full text-white"><a class="p-3 inline-block w-full text-lg bg-transparent rounded-md transition-colors hover:bg-zinc-800 hover:text-white" href="/#About">О компании</a></li><li class="w-full text-white"><a class="p-3 inline-block w-full text-lg bg-transparent rounded-md transition-colors hover:bg-zinc-800 hover:text-white" href="/Jobs">Вакансии</a></li><li class="w-full text-white"><a class="p-3 inline-block w-full text-lg bg-transparent rounded-md transition-colors hover:bg-zinc-800 hover:text-white" href="/Articles">Блог</a></li><li class="w-full text-white"><a class="p-3 inline-block w-full text-lg bg-transparent rounded-md transition-colors hover:bg-zinc-800 hover:text-white" href="/Projects">Проекты</a></li></menu></div></aside></header><div class="py-30"><div class="w-full px-2 sm:px-6 md:px-14 lg:px-24 max-w-[1480px] mx-auto"><div class="w-full mx-auto py-10"><div class="shadow-2xl px-5 py-2 rounded-2xl bg-gray-100"><div class=" w-full h-auto rounded-xl overflow-hidden"><img alt="" loading="lazy" width="1" height="1" decoding="async" data-nimg="1" class="object-cover w-full h-full" style="color:transparent" sizes="1000" srcSet="/_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=32&amp;q=75 32w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=48&amp;q=75 48w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=64&amp;q=75 64w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=96&amp;q=75 96w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=128&amp;q=75 128w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=256&amp;q=75 256w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=384&amp;q=75 384w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=https%3A%2F%2Fstrapitest.ybru.ru%2Fuploads%2FPage10_4_25f4b0da1b.png&amp;w=3840&amp;q=75"/></div><h1 class="text-3xl text-black font-bold mb-4">Подружить Gorm и PostGIS, решение промышленного уровня</h1><p class="text-gray-600 mb-6">
Интеграция GORM и PostGIS для работы с геоданными в микросервисах на Go может быть сложной из-за отсутствия нативной поддержки геометрических типов данных в GORM. В статье описано, как обойти эту проблему с помощью собственного решения — библиотеки georm, предоставляющей поддержку таких типов, как Point, Polygon и других.</p></div><div class="text-black bg-white "><h1 class="text-4xl my-10 font-bold ">Как подружить Gorm и PostGIS, решение промышленного уровня.</h1>
<p><a href="https://gorm.io/" class="text-blue-500 hover:underline hover:text-purple-700">GORM</a> Фантастическая ORM для Golang.</p>
<p><a href="https://postgis.net/" class="text-blue-500 hover:underline hover:text-purple-700">PostGIS</a> расширяет возможности реляционной базы данных <a href="https://postgresql.org/" class="text-blue-500 hover:underline hover:text-purple-700">PostgreSQL</a> , добавляя поддержку хранения, индексирования и запросов геопространственных данных.</p>
<p>В этой статье поделимся своим опытом интеграции GORM и PostGIS, сложностями при попытке использования gorm для работы с геометрическими данными и конечно предлагаем готовое решение.</p>
<h3 class="text-2xl my-5 font-semibold  ">Задача</h3>
<p>Реализация микросервиса, отвечающего за работу с геоданными:</p>

    <ul class="list-disc ps-6" >
    <li>Хранение полигонов зон доставки;</li>
<li>Хранение точек доставки (адресов покупателей);</li>
<li>Поиск вхождений точки в зоны доставки заведений;</li>
<li>Хранение маршрутов доставки, рассчитанных с учётом различных параметров.</li>
</ul>
<p>Поскольку, большая часть микросервисов в проекте (часть проекта описана в кейсе <a href="https://ybru.ru/projects/telegram-app-shawarma-bar-and-kinto-s/" class="text-blue-500 hover:underline hover:text-purple-700">Telegram App Shawarma bar &amp; KINTO’S</a>) написана на Go с основной реляционной СУБД PostgreSQL.  Было принято решение хранить данные микросервиса также в PostgreSQL, учитывая предшествующий положительный опыт работы с его расширением PostGIS.</p>
<p>Был определён следующий <strong>стек технологий</strong>: Go, GORM, PostgreSQL, PostGIS.</p>
<h4 class="text-xl my-3 font-medium ">Проблема интеграции GORM и PostGIS</h4>
<p>Однако с самого начала было понятно что GORM не поддерживает геометрические типы данных “из коробки”, поэтому было принято решение использовать сырые SQL-запросы. Это решение не позволяло раскрыть возможности GORM и значительно увеличило сложность разработки и сопровождения микросервиса.</p>
<p>Поиск решения в интернете не привёл к успеху. Единственное, что удалось найти - это пример реализации пользовательского типа <code>Location</code> на <a href="https://gorm.io/docs/data_types.html" class="text-blue-500 hover:underline hover:text-purple-700">сайте GORM</a> и несколько библиотек, поддерживающих лишь базовые геометрические типы (<code>Point</code> и в некоторых случаях <code>Polygon</code>).</p>
<h4 class="text-xl my-3 font-medium ">Пример использования SQL-запросов для работы с геоданными</h4>
<p>Для работы с геометрическими данными приходилось использовать SQL-запросы. Например, для получения полигона:</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">SELECT 
	p.id, 
	p.address_id, 
	ST_AsText(p.geo_polygon) as geo_polygon,
FROM public.polygons p 
WHERE p.id = $1
</code></pre><p>Поле geo_polygon содержит полигон, с помощью функции <code>ST_AsText</code> преобразуется в текстовый формат wkt.</p>
<p>Пример строки WKT, которая может содержаться в поле geo_polygon:</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))
</code></pre><p>Затем этот текст нужно преобразовать в структуру для работы с полигоном внутри приложения.</p>
<p>Для создания таблиц с геометрическими типами данных (миграции) также приходилось писать SQL-запросы:</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">CREATE TABLE IF NOT EXISTS public.addresses (
	id bigserial,
	address text NULL,
	geo_point geometry NOT NULL,

	CONSTRAINT pk_address_id PRIMARY KEY(id)
);
</code></pre><h4 class="text-xl my-3 font-medium ">Основные проблемы</h4>

    <ol class="list-decimal ps-6" >
    <li>По сравнению с функциями которые используют возможности gorm в полном объёме, функции с SQL запросами были в 2-3 раза длиннее и соответственно менее читаемые.</li>
<li>Пропадает возможность использовать автоматическую миграцию gorm.</li>
<li>Был выбран неподходящий формат данных, так как использование WKT в разы менее производителен чем WKB, убедиться в этом помог <a href="https://github.com/opengeospatial/geoparquet/discussions/170#discussioncomment-5800433" class="text-blue-500 hover:underline hover:text-purple-700">бенчмарк</a>, который наглядно показывает разницу в производительности при работе с форматами WKT и WKB.</li>
</ol>
<p>Результаты бенчмарка:</p>
<div class="table-responsive"><table class="border-collapse border-gray-500 w-full overflow-x-auto table-auto">
    <thead class="border-gray-500"><tr class="border border-gray-500 p-2"><th class="border border-gray-500 p-2  font-medium ">Format</th>
<th class="border border-gray-500 p-2  font-medium ">size</th>
<th class="border border-gray-500 p-2  font-medium ">convert to</th>
<th class="border border-gray-500 p-2  font-medium ">convert from</th>
<th class="border border-gray-500 p-2  font-medium ">serialize to parquet</th>
<th class="border border-gray-500 p-2  font-medium ">deserialize from parquet</th>
</tr>
</thead>
<tbody>
<tr class="border border-gray-500 p-2"><td class="border border-gray-500 p-2 text-center">wkb</td>
<td class="border border-gray-500 p-2 text-center">54.6 MB</td>
<td class="border border-gray-500 p-2 text-center">0.089s</td>
<td class="border border-gray-500 p-2 text-center">0.046s</td>
<td class="border border-gray-500 p-2 text-center">0.044s</td>
<td class="border border-gray-500 p-2 text-center">0.03s</td>
</tr>
<tr class="border border-gray-500 p-2"><td class="border border-gray-500 p-2 text-center">wkt</td>
<td class="border border-gray-500 p-2 text-center">71.6 MB</td>
<td class="border border-gray-500 p-2 text-center">0.44s</td>
<td class="border border-gray-500 p-2 text-center">0.45s</td>
<td class="border border-gray-500 p-2 text-center">0.38s</td>
<td class="border border-gray-500 p-2 text-center">0.12s</td>
</tr>
</tbody>
</table></div>
<p>Из результатов видно, что преобразование полигона в текстовый формат WKT для передачи в БД занимает в 5 раз больше времени, чем преобразование в бинарный формат WKB. А получения значения из базы в текстовом формате потребует в 9 раз больше времени чем данных в бинарном формате.</p>
<h3 class="text-2xl my-5 font-semibold  ">Решение</h3>
<p>Для упрощения и оптимизации работы с геоданными в GORM было принято решения написать свои типы для геометрий, которые будут расширять функциональность gorm.</p>
<p>Реализована поддержка следующих типов:</p>

    <ul class="list-disc ps-6" >
    <li>Point</li>
<li>LineString</li>
<li>Polygon</li>
<li>MultiPoint</li>
<li>MultiLineString</li>
<li>MultiPolygon</li>
<li>GeometryCollection</li>
</ul>
<p>Реализация интерфейсов:</p>

    <ul class="list-disc ps-6" >
    <li><a href="https://pkg.go.dev/database/sql#Scanner" class="text-blue-500 hover:underline hover:text-purple-700">sql.Scanner</a> и <a href="https://pkg.go.dev/database/sql/driver#Valuer" class="text-blue-500 hover:underline hover:text-purple-700">driver.Valuer</a> способствовала простому получению и записи данных.</li>
<li><a href="https://pkg.go.dev/gorm.io/gorm/schema#GormDataTypeInterface" class="text-blue-500 hover:underline hover:text-purple-700">schema.GormDataTypeInterface</a> обеспечила правильное поведение GORM при миграции таблиц с геометрическими типами.</li>
<li><a href="https://pkg.go.dev/fmt#Stringer" class="text-blue-500 hover:underline hover:text-purple-700">fmt.Stringer</a> добавила возможность отображения данных в человеко читаемом формате WKT.</li>
</ul>
<p>В основе решения лежит библиотека <a href="github.com/twpayne/go-geom" class="text-blue-500 hover:underline hover:text-purple-700">go-geom</a> реализующая эффективные типы геометрии для геопространственных приложений, кроме того go-geom имеет поддержку неограниченного количества измерений, реализует кодирование и декодирование в формат wkb и другие форматы, функции для работы с 2D и 3D топологиями и другие особенности.</p>
<p>Решение является в некотором роде адаптацией go-geom для работы с GORM и получило название <strong>georm</strong> (сочетание слов “geometry” и “ORM”). Вы можете ознакомиться с решением на GitHub <a href="https://github.com/ybru-tech/georm" class="text-blue-500 hover:underline hover:text-purple-700">georm</a>.</p>
<h4 class="text-xl my-3 font-medium ">Примеры использования</h4>
<p>Описание структур с геометрическими типами:</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">type Address struct {  
    ID       uint `gorm:&quot;primaryKey&quot;`  
    Address  string  
    GeoPoint georm.Point  
}  
  
type Zone struct {  
    ID         uint `gorm:&quot;primaryKey&quot;`  
    Title      string  
    GeoPolygon georm.Polygon  
}
</code></pre><p>Простая, автоматическая миграция gorm.</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">db.AutoMigrate(  
    // CREATE TABLE &quot;addresses&quot; (&quot;id&quot; bigserial,&quot;address&quot; text,&quot;geo_point&quot; Geometry(Point, 4326),PRIMARY KEY (&quot;id&quot;))  
    Address{},  
    // CREATE TABLE &quot;zones&quot; (&quot;id&quot; bigserial,&quot;title&quot; text,&quot;geo_polygon&quot; Geometry(Polygon, 4326),PRIMARY KEY (&quot;id&quot;))  
    Zone{},  
)
</code></pre><p>Полноценное использование возможностей ORM для запросов, передача геометрических данных в wkb формате:</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">// INSERT INTO &quot;addresses&quot; (&quot;address&quot;,&quot;geo_point&quot;) VALUES ('some address','010100000000000000000045400000000000003840') RETURNING &quot;id&quot;  
tx.Create(&amp;Address{  
    Address: &quot;some address&quot;,  
    GeoPoint: georm.Point{  
       Geom: geom.NewPoint(geom.XY).MustSetCoords(geom.Coord{42, 24}),  
    },  
})
// ...

// INSERT INTO &quot;zones&quot; (&quot;title&quot;,&quot;geo_polygon&quot;) VALUES ('some zone','010300000001000000050000000000000000003e4000000000000024400000000000004440000000000000444000000000000034400000000000004440000000000000244000000000000034400000000000003e400000000000002440') RETURNING &quot;id&quot;
tx.Create(&amp;Zone{  
    Title: &quot;some zone&quot;,  
    GeoPolygon: georm.Polygon{  
       Geom: geom.NewPolygon(geom.XY).MustSetCoords([][]geom.Coord{  
          {{30, 10}, {40, 40}, {20, 40}, {10, 20}, {30, 10}},  
       }),  
    },  
})
// ...

// SELECT * FROM &quot;zones&quot; WHERE ST_Contains(geo_polygon, '0101000020e610000000000000000039400000000000003a40') ORDER BY &quot;zones&quot;.&quot;id&quot; LIMIT 1  
db.Model(&amp;Zone{}).  
    Where(&quot;ST_Contains(geo_polygon, ?)&quot;, point).  
    First(&amp;result)
// ...

</code></pre><p>Не большой бонус - реализация интерфейса fmt.Stringer, вывод в человеко читаемом wkt формате.</p>
<pre class="my-6"><code class="block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words">// POINT (25 26)  
fmt.Println(georm.Point{  
    Geom: geom.NewPoint(geom.XY).MustSetCoords(geom.Coord{25, 26}).SetSRID(georm.SRID),  
})  
  
// POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))  
fmt.Println(georm.Polygon{  
    Geom: geom.NewPolygon(geom.XY).MustSetCoords([][]geom.Coord{  
       {{30, 10}, {40, 40}, {20, 40}, {10, 20}, {30, 10}},  
    }),  
})
</code></pre><p>Для получения дополнительной информации и примеров использования посетите репозиторий <a href="https://github.com/ybru-tech/georm" class="text-blue-500 hover:underline hover:text-purple-700">georm на GitHub</a>.</p>
</div></div></div></div><!--$--><!--/$--><footer class="bg-blue-950 p-5"><div class="max-w-[1480px] mx-auto"><div class="grid grid-cols-1 gap-10 md:grid-cols-2 lg:grid-cols-4 justify-between w-full "><div class="flex flex-col gap-10 order-1"><img alt="Logo" loading="lazy" width="170" height="40" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/Logo_footer.05098c44.svg"/><p class="max-w-80 text-lg text-gray-300">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Commodi incidunt ipsa iste labore natus nemo rerum saepe. Aliquid eius nisi quia quidem similique veniam vero.</p></div><div class="flex flex-col gap-5 md:order-3 order-2"><h3 class="text-2xl ">Информация</h3><nav class="w-full"><menu class=" flex flex-col  gap-y-1.5 w-full  text-lg "><li><a class="hover:text-indigo-500 transition-all duration-300" href="/#About">О компании</a></li><li><a class="hover:text-indigo-500 transition-all duration-300" href="/Jobs">Вакансии</a></li><li><a class="hover:text-indigo-500 transition-all duration-300" href="/Articles">Блог</a></li><li><a class="hover:text-indigo-500 transition-all duration-300" href="/Projects">Проекты</a></li></menu></nav></div><div class="flex flex-col text-2xl gap-2 md-order-2 order-3"><a class="hover:text-indigo-500 transition-all duration-300" href="">example@mail.com</a><a class="hover:text-indigo-500 transition-all duration-300" href="">+7 232 2322 23 23</a></div><div class="order-4"><button data-slot="button" class="inline-flex cursor items-center justify-center gap-2 cursor-pointer whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive text-primary-foreground h-9 has-[&gt;svg]:px-3 text-2xl bg-transparent hover:bg-transparent border-2 rounded-4xl font-normal border-blue-500 py-8 px-6">Связаться с нами</button></div></div></div></footer><script src="/_next/static/chunks/340e600f8638470f.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[92825,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ClientSegmentRoot\"]\n3:I[53642,[\"/_next/static/chunks/830a5e4b540dd4df.js\",\"/_next/static/chunks/3ed9d616c74adb07.js\",\"/_next/static/chunks/ad0a5a8fb2ac436e.js\",\"/_next/static/chunks/0434e8cb22e550ab.js\"],\"default\"]\n4:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n5:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"default\"]\n8:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"OutletBoundary\"]\n9:\"$Sreact.suspense\"\nb:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"ViewportBoundary\"]\nd:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"MetadataBoundary\"]\nf:I[68027,[],\"default\"]\n:HL[\"/_next/static/chunks/cbe20c40552e0328.css\",\"style\"]\n:HL[\"/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"iMnIBittzbL6au_Q1HsmL\",\"c\":[\"\",\"Articles\",\"3\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"Articles\",{\"children\":[[\"id\",\"3\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/cbe20c40552e0328.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/830a5e4b540dd4df.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/3ed9d616c74adb07.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/ad0a5a8fb2ac436e.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/0434e8cb22e550ab.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L2\",null,{\"Component\":\"$3\",\"slots\":{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"serverProvidedParams\":{\"params\":{},\"promises\":[\"$@6\"]}}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",null,[\"$\",\"$L8\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@a\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Lb\",null,{\"children\":\"$@c\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Ld\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.Metadata\",\"children\":\"$@e\"}]}]}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"6:\"$0:f:0:1:0:props:children:1:props:serverProvidedParams:params\"\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"10:I[27201,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/247eb132b7f7b574.js\"],\"IconMark\"]\ne:[[\"$\",\"link\",\"0\",{\"rel\":\"icon\",\"href\":\"/favicon.ico?favicon.0b3bf435.ico\",\"sizes\":\"256x256\",\"type\":\"image/x-icon\"}],[\"$\",\"$L10\",\"1\",{}]]\na:null\n"])</script><script>self.__next_f.push([1,"11:I[5500,[\"/_next/static/chunks/830a5e4b540dd4df.js\",\"/_next/static/chunks/3ed9d616c74adb07.js\",\"/_next/static/chunks/ad0a5a8fb2ac436e.js\",\"/_next/static/chunks/0434e8cb22e550ab.js\"],\"Image\"]\n12:T3b3f,"])</script><script>self.__next_f.push([1,"\u003ch1 class=\"text-4xl my-10 font-bold \"\u003eКак подружить Gorm и PostGIS, решение промышленного уровня.\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://gorm.io/\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003eGORM\u003c/a\u003e Фантастическая ORM для Golang.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://postgis.net/\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003ePostGIS\u003c/a\u003e расширяет возможности реляционной базы данных \u003ca href=\"https://postgresql.org/\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003ePostgreSQL\u003c/a\u003e , добавляя поддержку хранения, индексирования и запросов геопространственных данных.\u003c/p\u003e\n\u003cp\u003eВ этой статье поделимся своим опытом интеграции GORM и PostGIS, сложностями при попытке использования gorm для работы с геометрическими данными и конечно предлагаем готовое решение.\u003c/p\u003e\n\u003ch3 class=\"text-2xl my-5 font-semibold  \"\u003eЗадача\u003c/h3\u003e\n\u003cp\u003eРеализация микросервиса, отвечающего за работу с геоданными:\u003c/p\u003e\n\n    \u003cul class=\"list-disc ps-6\" \u003e\n    \u003cli\u003eХранение полигонов зон доставки;\u003c/li\u003e\n\u003cli\u003eХранение точек доставки (адресов покупателей);\u003c/li\u003e\n\u003cli\u003eПоиск вхождений точки в зоны доставки заведений;\u003c/li\u003e\n\u003cli\u003eХранение маршрутов доставки, рассчитанных с учётом различных параметров.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eПоскольку, большая часть микросервисов в проекте (часть проекта описана в кейсе \u003ca href=\"https://ybru.ru/projects/telegram-app-shawarma-bar-and-kinto-s/\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003eTelegram App Shawarma bar \u0026amp; KINTO’S\u003c/a\u003e) написана на Go с основной реляционной СУБД PostgreSQL.  Было принято решение хранить данные микросервиса также в PostgreSQL, учитывая предшествующий положительный опыт работы с его расширением PostGIS.\u003c/p\u003e\n\u003cp\u003eБыл определён следующий \u003cstrong\u003eстек технологий\u003c/strong\u003e: Go, GORM, PostgreSQL, PostGIS.\u003c/p\u003e\n\u003ch4 class=\"text-xl my-3 font-medium \"\u003eПроблема интеграции GORM и PostGIS\u003c/h4\u003e\n\u003cp\u003eОднако с самого начала было понятно что GORM не поддерживает геометрические типы данных “из коробки”, поэтому было принято решение использовать сырые SQL-запросы. Это решение не позволяло раскрыть возможности GORM и значительно увеличило сложность разработки и сопровождения микросервиса.\u003c/p\u003e\n\u003cp\u003eПоиск решения в интернете не привёл к успеху. Единственное, что удалось найти - это пример реализации пользовательского типа \u003ccode\u003eLocation\u003c/code\u003e на \u003ca href=\"https://gorm.io/docs/data_types.html\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003eсайте GORM\u003c/a\u003e и несколько библиотек, поддерживающих лишь базовые геометрические типы (\u003ccode\u003ePoint\u003c/code\u003e и в некоторых случаях \u003ccode\u003ePolygon\u003c/code\u003e).\u003c/p\u003e\n\u003ch4 class=\"text-xl my-3 font-medium \"\u003eПример использования SQL-запросов для работы с геоданными\u003c/h4\u003e\n\u003cp\u003eДля работы с геометрическими данными приходилось использовать SQL-запросы. Например, для получения полигона:\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003eSELECT \n\tp.id, \n\tp.address_id, \n\tST_AsText(p.geo_polygon) as geo_polygon,\nFROM public.polygons p \nWHERE p.id = $1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eПоле geo_polygon содержит полигон, с помощью функции \u003ccode\u003eST_AsText\u003c/code\u003e преобразуется в текстовый формат wkt.\u003c/p\u003e\n\u003cp\u003eПример строки WKT, которая может содержаться в поле geo_polygon:\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003ePOLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eЗатем этот текст нужно преобразовать в структуру для работы с полигоном внутри приложения.\u003c/p\u003e\n\u003cp\u003eДля создания таблиц с геометрическими типами данных (миграции) также приходилось писать SQL-запросы:\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003eCREATE TABLE IF NOT EXISTS public.addresses (\n\tid bigserial,\n\taddress text NULL,\n\tgeo_point geometry NOT NULL,\n\n\tCONSTRAINT pk_address_id PRIMARY KEY(id)\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 class=\"text-xl my-3 font-medium \"\u003eОсновные проблемы\u003c/h4\u003e\n\n    \u003col class=\"list-decimal ps-6\" \u003e\n    \u003cli\u003eПо сравнению с функциями которые используют возможности gorm в полном объёме, функции с SQL запросами были в 2-3 раза длиннее и соответственно менее читаемые.\u003c/li\u003e\n\u003cli\u003eПропадает возможность использовать автоматическую миграцию gorm.\u003c/li\u003e\n\u003cli\u003eБыл выбран неподходящий формат данных, так как использование WKT в разы менее производителен чем WKB, убедиться в этом помог \u003ca href=\"https://github.com/opengeospatial/geoparquet/discussions/170#discussioncomment-5800433\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003eбенчмарк\u003c/a\u003e, который наглядно показывает разницу в производительности при работе с форматами WKT и WKB.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eРезультаты бенчмарка:\u003c/p\u003e\n\u003cdiv class=\"table-responsive\"\u003e\u003ctable class=\"border-collapse border-gray-500 w-full overflow-x-auto table-auto\"\u003e\n    \u003cthead class=\"border-gray-500\"\u003e\u003ctr class=\"border border-gray-500 p-2\"\u003e\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003eFormat\u003c/th\u003e\n\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003esize\u003c/th\u003e\n\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003econvert to\u003c/th\u003e\n\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003econvert from\u003c/th\u003e\n\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003eserialize to parquet\u003c/th\u003e\n\u003cth class=\"border border-gray-500 p-2  font-medium \"\u003edeserialize from parquet\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr class=\"border border-gray-500 p-2\"\u003e\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003ewkb\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e54.6 MB\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.089s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.046s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.044s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.03s\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr class=\"border border-gray-500 p-2\"\u003e\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003ewkt\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e71.6 MB\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.44s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.45s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.38s\u003c/td\u003e\n\u003ctd class=\"border border-gray-500 p-2 text-center\"\u003e0.12s\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003cp\u003eИз результатов видно, что преобразование полигона в текстовый формат WKT для передачи в БД занимает в 5 раз больше времени, чем преобразование в бинарный формат WKB. А получения значения из базы в текстовом формате потребует в 9 раз больше времени чем данных в бинарном формате.\u003c/p\u003e\n\u003ch3 class=\"text-2xl my-5 font-semibold  \"\u003eРешение\u003c/h3\u003e\n\u003cp\u003eДля упрощения и оптимизации работы с геоданными в GORM было принято решения написать свои типы для геометрий, которые будут расширять функциональность gorm.\u003c/p\u003e\n\u003cp\u003eРеализована поддержка следующих типов:\u003c/p\u003e\n\n    \u003cul class=\"list-disc ps-6\" \u003e\n    \u003cli\u003ePoint\u003c/li\u003e\n\u003cli\u003eLineString\u003c/li\u003e\n\u003cli\u003ePolygon\u003c/li\u003e\n\u003cli\u003eMultiPoint\u003c/li\u003e\n\u003cli\u003eMultiLineString\u003c/li\u003e\n\u003cli\u003eMultiPolygon\u003c/li\u003e\n\u003cli\u003eGeometryCollection\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eРеализация интерфейсов:\u003c/p\u003e\n\n    \u003cul class=\"list-disc ps-6\" \u003e\n    \u003cli\u003e\u003ca href=\"https://pkg.go.dev/database/sql#Scanner\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003esql.Scanner\u003c/a\u003e и \u003ca href=\"https://pkg.go.dev/database/sql/driver#Valuer\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003edriver.Valuer\u003c/a\u003e способствовала простому получению и записи данных.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://pkg.go.dev/gorm.io/gorm/schema#GormDataTypeInterface\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003eschema.GormDataTypeInterface\u003c/a\u003e обеспечила правильное поведение GORM при миграции таблиц с геометрическими типами.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://pkg.go.dev/fmt#Stringer\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003efmt.Stringer\u003c/a\u003e добавила возможность отображения данных в человеко читаемом формате WKT.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eВ основе решения лежит библиотека \u003ca href=\"github.com/twpayne/go-geom\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003ego-geom\u003c/a\u003e реализующая эффективные типы геометрии для геопространственных приложений, кроме того go-geom имеет поддержку неограниченного количества измерений, реализует кодирование и декодирование в формат wkb и другие форматы, функции для работы с 2D и 3D топологиями и другие особенности.\u003c/p\u003e\n\u003cp\u003eРешение является в некотором роде адаптацией go-geom для работы с GORM и получило название \u003cstrong\u003egeorm\u003c/strong\u003e (сочетание слов “geometry” и “ORM”). Вы можете ознакомиться с решением на GitHub \u003ca href=\"https://github.com/ybru-tech/georm\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003egeorm\u003c/a\u003e.\u003c/p\u003e\n\u003ch4 class=\"text-xl my-3 font-medium \"\u003eПримеры использования\u003c/h4\u003e\n\u003cp\u003eОписание структур с геометрическими типами:\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003etype Address struct {  \n    ID       uint `gorm:\u0026quot;primaryKey\u0026quot;`  \n    Address  string  \n    GeoPoint georm.Point  \n}  \n  \ntype Zone struct {  \n    ID         uint `gorm:\u0026quot;primaryKey\u0026quot;`  \n    Title      string  \n    GeoPolygon georm.Polygon  \n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eПростая, автоматическая миграция gorm.\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003edb.AutoMigrate(  \n    // CREATE TABLE \u0026quot;addresses\u0026quot; (\u0026quot;id\u0026quot; bigserial,\u0026quot;address\u0026quot; text,\u0026quot;geo_point\u0026quot; Geometry(Point, 4326),PRIMARY KEY (\u0026quot;id\u0026quot;))  \n    Address{},  \n    // CREATE TABLE \u0026quot;zones\u0026quot; (\u0026quot;id\u0026quot; bigserial,\u0026quot;title\u0026quot; text,\u0026quot;geo_polygon\u0026quot; Geometry(Polygon, 4326),PRIMARY KEY (\u0026quot;id\u0026quot;))  \n    Zone{},  \n)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eПолноценное использование возможностей ORM для запросов, передача геометрических данных в wkb формате:\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003e// INSERT INTO \u0026quot;addresses\u0026quot; (\u0026quot;address\u0026quot;,\u0026quot;geo_point\u0026quot;) VALUES ('some address','010100000000000000000045400000000000003840') RETURNING \u0026quot;id\u0026quot;  \ntx.Create(\u0026amp;Address{  \n    Address: \u0026quot;some address\u0026quot;,  \n    GeoPoint: georm.Point{  \n       Geom: geom.NewPoint(geom.XY).MustSetCoords(geom.Coord{42, 24}),  \n    },  \n})\n// ...\n\n// INSERT INTO \u0026quot;zones\u0026quot; (\u0026quot;title\u0026quot;,\u0026quot;geo_polygon\u0026quot;) VALUES ('some zone','010300000001000000050000000000000000003e4000000000000024400000000000004440000000000000444000000000000034400000000000004440000000000000244000000000000034400000000000003e400000000000002440') RETURNING \u0026quot;id\u0026quot;\ntx.Create(\u0026amp;Zone{  \n    Title: \u0026quot;some zone\u0026quot;,  \n    GeoPolygon: georm.Polygon{  \n       Geom: geom.NewPolygon(geom.XY).MustSetCoords([][]geom.Coord{  \n          {{30, 10}, {40, 40}, {20, 40}, {10, 20}, {30, 10}},  \n       }),  \n    },  \n})\n// ...\n\n// SELECT * FROM \u0026quot;zones\u0026quot; WHERE ST_Contains(geo_polygon, '0101000020e610000000000000000039400000000000003a40') ORDER BY \u0026quot;zones\u0026quot;.\u0026quot;id\u0026quot; LIMIT 1  \ndb.Model(\u0026amp;Zone{}).  \n    Where(\u0026quot;ST_Contains(geo_polygon, ?)\u0026quot;, point).  \n    First(\u0026amp;result)\n// ...\n\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eНе большой бонус - реализация интерфейса fmt.Stringer, вывод в человеко читаемом wkt формате.\u003c/p\u003e\n\u003cpre class=\"my-6\"\u003e\u003ccode class=\"block p-4  rounded bg-blue-950 text-white font-mono text-sm whitespace-pre-wrap break-words\"\u003e// POINT (25 26)  \nfmt.Println(georm.Point{  \n    Geom: geom.NewPoint(geom.XY).MustSetCoords(geom.Coord{25, 26}).SetSRID(georm.SRID),  \n})  \n  \n// POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))  \nfmt.Println(georm.Polygon{  \n    Geom: geom.NewPolygon(geom.XY).MustSetCoords([][]geom.Coord{  \n       {{30, 10}, {40, 40}, {20, 40}, {10, 20}, {30, 10}},  \n    }),  \n})\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eДля получения дополнительной информации и примеров использования посетите репозиторий \u003ca href=\"https://github.com/ybru-tech/georm\" class=\"text-blue-500 hover:underline hover:text-purple-700\"\u003egeorm на GitHub\u003c/a\u003e.\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"py-30\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full px-2 sm:px-6 md:px-14 lg:px-24 max-w-[1480px] mx-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full mx-auto py-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"shadow-2xl px-5 py-2 rounded-2xl bg-gray-100\",\"children\":[[\"$\",\"div\",null,{\"className\":\" w-full h-auto rounded-xl overflow-hidden\",\"children\":[\"$\",\"$L11\",null,{\"src\":\"https://strapitest.ybru.ru/uploads/Page10_4_25f4b0da1b.png\",\"alt\":\"\",\"width\":1,\"height\":1,\"className\":\"object-cover w-full h-full\",\"sizes\":\"1000\"}]}],[\"$\",\"h1\",null,{\"className\":\"text-3xl text-black font-bold mb-4\",\"children\":\"Подружить Gorm и PostGIS, решение промышленного уровня\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-600 mb-6\",\"children\":\"\\nИнтеграция GORM и PostGIS для работы с геоданными в микросервисах на Go может быть сложной из-за отсутствия нативной поддержки геометрических типов данных в GORM. В статье описано, как обойти эту проблему с помощью собственного решения — библиотеки georm, предоставляющей поддержку таких типов, как Point, Polygon и других.\"}]]}],[\"$\",\"div\",null,{\"className\":\"text-black bg-white \",\"dangerouslySetInnerHTML\":{\"__html\":\"$12\"}}]]}]}]}]\n"])</script></body></html>